<ng-container *ngIf="!useCdk; else cdkTemplate">
  <div #scrollContainer style="overflow-y: auto; height: 100%;" (scroll)="handleScroll()">
    <div class="top-spacer" [style.height.px]="topSpacerHeight"></div>
    <ng-container *ngFor="let i of visibleIndices; trackBy: trackByVisibleIndex">
      <ng-container *ngTemplateOutlet="itemTemplate; context: { $implicit: items[i], index: i }"></ng-container>
    </ng-container>
    <div class="bottom-spacer" [style.height.px]="bottomSpacerHeight"></div>
  </div>
</ng-container>
<ng-template #cdkTemplate>
  <div #scrollContainer style="height: 100%; overflow: hidden;">
    <cdk-virtual-scroll-viewport #viewport [itemSize]="itemSizeForCdk" [minBufferPx]="bufferPx" class="viewport"
      (scrolledIndexChange)="handleCdkScroll($event)">
      <ng-container *cdkVirtualFor="let item of items; trackBy: trackBy; let i = index">
        <ng-container *ngTemplateOutlet="itemTemplate; context: { $implicit: item, index: i }"></ng-container>
      </ng-container>
    </cdk-virtual-scroll-viewport>
  </div>
</ng-template>
<ng-container #measurer></ng-container>
